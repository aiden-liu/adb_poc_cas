# CAS

The 'CAS' project was generated by using the dbt template for
Databricks Asset Bundles. It follows the standard dbt project structure
and has an additional `resources` directory to define Databricks resources such as jobs
that run dbt models.

- Data source: https://opendata-nzta.opendata.arcgis.com/datasets/NZTA::crash-analysis-system-cas-data-1/about
- Learn more about dbt and its standard project structure here: https://docs.getdbt.com/docs/build/projects.
- Learn more about Databricks Asset Bundles here: https://docs.databricks.com/en/dev-tools/bundles/index.html

The remainder of this file includes instructions for local development (using dbt)
and deployment to production (using Databricks Asset Bundles).

## About CAS Data

### Summary

Data about all traffic crashes reported to us by the NZ Police

See our: [Crash Analysis System (CAS) data user guide](https://sway.office.com/wdD0YYkdOqysqaQm?ref=Link)

This data comes from the Waka Kotahi Crash Analysis System (CAS), which records all traffic crashes reported to us by the NZ Police. CAS covers crashes on all New Zealand roadways or places where the public have legal access with a motor vehicle.

The data updates monthly, in the first week of each month.

Data is currently available from 1 January 2000. The dataset includes crash variables that are non-personal data.

To give you a quick overview of the data, see the charts in the ‘Attributes’ section below. These will give you information about each of the attributes (variables) in the dataset.

Each chart is specific to a variable, and shows all data (without any filters applied).

### Crash Analysis System data - field descriptions

[Crash Analysis Systems data, map and user guides.](https://opendata-nzta.opendata.arcgis.com/search?q=CAS)

### Data Field Descriptions

| Attribute Name            | Alias Name                  | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| ------------------------- | --------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| advisorySpeed             | Advisory Speed              | The advisory (adv) speed (spd) at the crash site at the time of the crash.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| areaUnitID                | Area Unit ID                | The unique identifier of an area unit.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| bicycle                   | Bicycle                     | Derived variable to indicate how many bicycles were involved in the crash.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| bridge                    | Bridge                      | Derived variable to indicate how many times a bridge, tunnel, the abutments, handrails were struck in the crash.                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| bus                       | Bus                         | Derived variable to indicate how many buses were involved in the crash (excluding school buses which are counted in the SCHOOL_BUS field).                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| carStationWagon           | Car/Station Wagon           | Derived variable to indicate how many cars or station wagons were involved in the crash.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| cliffBank                 | Cliff or Bank               | Derived variable to indicate how many times a 'cliff' or 'bank' was struck in the crash. This includes retaining walls                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| crashDirectionDescription | Crash Direction Description | The direction (dirn) of the crash from the reference point. Values possible are 'North', 'East', 'South' or 'West'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| crashDistance             | Crash Distance              | The distance (dist) of the crash from the reference point for the crash. The reference point is often the intersection of 'crash road' and 'side road' (refer to 'cr_rd_sd_rd' variable).                                                                                                                                                                                                                                                                                                                                                                                                      |
| crashFinancialYear        | Crash Financial Year        | The financial (fin) year in which a crash occurred, if known. This is displayed as a string field. eg 2004/2005                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| crashLocation1            | Crash Location 1            | Part 1 of the 'crash location' (crash_locn). May be a road name, route position (RP), landmark, or other, e.g. 'Ninety Mile Beach'. Used for location descriptions in reports etc.                                                                                                                                                                                                                                                                                                                                                                                                             |
| crashLocation2            | Crash Location 2            | Part 2 of the 'crash location' (crash_locn). May be a side road name, landmark etc. Used for location descriptions in reports etc.                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| crashSeverity             | Crash Severity              | The severity of a crash. Possible values are 'F' (fatal), 'S' (serious), 'M' (minor), 'N' (non-injury). This is determined by the worst injury sustained in the crash at time of entry.                                                                                                                                                                                                                                                                                                                                                                                                        |
| crashSHDescription1       | Crash SH Description        | Indicates where a crash is reported to have occurred on a State Highway (SH) marked '1', or on another road type marked '2'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| crashYear                 | Crash Year                  | The year in which a crash occurred, if known.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| debris                    | Debris                      | Derived variable to indicate how many times debris, boulders or items dropped or thrown from a vehicle(s) were struck in the crash                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| directionRoleDescription  | Direction Role Description  | The direction (dirn) of the principal vehicle involved in the crash. Possible values are North, South, East or West.                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| ditch                     | Ditch                       | Derived variable to indicate how many times a 'ditch' or 'waterable drainage channel' was struck in a crash.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| easting                   | Easting                     | The easting coordinate of an object (usually a crash) expressed in NZMG referred to the WGS84 datum to a precision of 1m. Please note, in some instances crashes are not able to be assigned to GPS co-ordinates. These crashes have been assigned eastings and northings of '0,0' in this dataset. There are two main reasons that a GPS coordinate cannot be allocated to a crash. Firstly, that the crash has been reported but the location was unknown. Secondly in a small number of instances, a crash may have occurred on a road which is not yet captured on the CAS spatial layer.  |
| fatalCount                | Fatal Count                 | A count of the number of fatal casualties associated with this crash.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| fence                     | Fence                       | Derived variable to indicate how many times a 'fence' was struck in the crash. This includes letterbox(es), hoardings, private roadside furniture, hedges, sight rails, etc.                                                                                                                                                                                                                                                                                                                                                                                                                   |
| flatHill                  | Flat Hill                   | Whether the road is flat or sloped. Possible values include 'Flat or 'Hill'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| guardRail                 | Guard Rail                  | Derived variable to indicate how many times a guard or guard rail was struck in the crash. This includes 'New Jersey' barriers, 'ARMCO', sand filled barriers, wire catch fences, etc.                                                                                                                                                                                                                                                                                                                                                                                                         |
| holiday                   | Holiday                     | Indicates where a crash occurred during a 'Christmas/New Year', 'Easter', 'Queens Birthday' or 'Labour Weekend' holiday period, otherwise 'None'.                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| houseOrBuilding           | House or Building           | Derived variable to indicate how many times a houses, garages, sheds or other buildings(Bldg) were struck in the crash                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| intersectionMidblock      | Intersection Midblock       | A derived variable to indicate if a crash occured at an intersection (intsn) or not. The 'intsn_midblock' variable is calculated using the 'intersection' and 'junction_type' variables. Values are 'Intersection' (where intersection variable = 'Intersection' or {'Intersection' = 'At Landmark' and junction_type is not in ('Unknown' or 'Driveway')} OR {Intersection = 'Unknown' and crash_dist <= 10}), otherwise 'Midblock' for crashes not meeting the criteria for 'Intersection').                                                                                                 |
| kerb                      | Kerb                        | Derived variable to indicate how many times a kerb was struck in the crash, that contributed directly to the crash.                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| light                     | Light                       | The light at the time and place of the crash. Possible values: 'Bright Sun', 'Overcast', 'Twilight, 'Dark' or ' Unknown'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| meshblockId               | Meshblock ID                | The unique identifier of a meshblock.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| minorInjuryCount          | Minor Injury Count          | A count of the number of minor injuries (inj) associated with this crash.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| moped                     | Moped                       | Derived variable to indicate how many mopeds were involved in the crash.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| motorcycle                | Motorcycle                  | Derived variable to indicate how many motorcycles were involved in the crash.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| northing                  | Northing                    | The northing coordinate of an object (usually a crash) expressed in NZMG referred to the WGS84 datum to a precision of 1m. Please note, in some instances crashes are not able to be assigned to GPS co-ordinates. These crashes have been assigned eastings and northings of '0,0' in this dataset. There are two main reasons that a GPS coordinate cannot be allocated to a crash. Firstly, that the crash has been reported but the location was unknown. Secondly in a small number of instances, a crash may have occurred on a road which is not yet captured on the CAS spatial layer. |
| NumberOfLanes             | Number of Lanes             | The number(num) of lanes on the crash road.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| objectThrownOrDropped     | Object thrown or dropped    | Derived variable to indicate how many times objects were thrown at or dropped on vehicles in the crash.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| otherObject               | Other Object                | Derived variable to indicate how many times an object was struck in a crash and the object struck was not pre-defined. This variable includes stockpiled materials, rubbish bins, fallen poles, fallen trees, etc.                                                                                                                                                                                                                                                                                                                                                                             |
| otherVehicleType          | Other Vehicle Type          | Derived variable to indicate how many other vehicles (not included in any other category) were involved in the crash.                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| overBank                  | Over Bank                   | Derived variable to indicate how many times an embankment was struck or driven over during a crash. This variable includes other vertical drops driven over during a crash.                                                                                                                                                                                                                                                                                                                                                                                                                    |
| parkedVehicle             | Parked Vehicle              | Derived variable to indicate how many times a parked or unattended vehicle was struck in the crash. This variable can include trailers.                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| phoneBoxEtc               | Phone Box etc.              | Derived variable to indicate how many times a telephone kiosk traffic signal controllers, bus shelters or other public furniture was struck in the crash                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| pedestrian                | Pedestrian                  | Derived variable to indicate how many pedestrians were involved in the crash. This includes pedestrians on skateboards, scooters and wheelchairs.                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| postOrPole                | Post or Pole                | Derived variable to indicate how many times a post or pole was struck in the crash. This includes light, power, phone, utility poles and objects practically forming part of a pole (i.e. 'Transformer Guy' wires)                                                                                                                                                                                                                                                                                                                                                                             |
| region                    | Region                      | Identifies the local government (LG) region. The boundaries match territorial local authority (TLA) boundaries                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| roadCharacter1            | Road Character              | The general nature of the road. Possible values include 'Bridge', 'Motorway Ramp', 'Rail crossing' or 'Nil'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| roadLane                  | Road Lane                   | The lane configuration of the road. Possible values : '1' (one way), '2' (two way), 'M' (for where a median exists), 'O' (for off-road lane configuarations), ' ' ( for unknown or invalid configuarations).                                                                                                                                                                                                                                                                                                                                                                                   |
| roadMarkings              | Road Markings               | The road markings at the crash site. Possible values: 'Ped Crossing' (for pedestrian crossings), 'Raised Island', 'Painted Island', 'No Passing Lanes', 'Centre Line', 'No Marks' or ' Unknown'.                                                                                                                                                                                                                                                                                                                                                                                               |
| roadSurface               | Road Surface                | The road surface description applying at the crash site. Possible values: 'Sealed' or 'Unsealed'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| roadworks                 | Road works                  | Derived variable to indicate how many times an object associated with 'roadworks' (including signs, cones, drums, barriers, but not roadwork vehicles) was struck during the crash                                                                                                                                                                                                                                                                                                                                                                                                             |
| schoolBus                 | School Bus                  | Derived variable to indicate how many school buses were involved in the crash.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| seriousInjuryCount        | Serious Injury Count        | A count of the number of serious injuries (inj) associated with this crash.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| slipOrFlood               | Slip or Flood               | Derived variable to indicate how many times landslips, washouts or floods (excluding rivers) were objects struck in the crash                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| speedLimit                | Speed Limit                 | The speed (spd) limit (lim) in force at the crash site at the time of the crash. May be a number, or 'LSZ' for a limited speed zone.                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| strayAnimal               | Stray Animal                | Derived variable to indicate how many times a stray animal(s) was struck in the crash. This variable includes wild animals such as pigs, goats, deer, straying farm animals, house pets and birds.                                                                                                                                                                                                                                                                                                                                                                                             |
| streetLight               | Street Light                | The street lighting at the time of the crash. Possible values 'On', 'Off', 'None' or ' Unknown'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| suv                       | SUV                         | Derived variable to indicate how many SUVs were involved in the crash.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| taxi                      | Taxi                        | Derived variable to indicate how many taxis were involved in the crash.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| tlaId                     | TLA ID                      | The unique identifier for a territorial local authority (TLA). Each crash is assigned a TLA based on where the crash occurred.                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| tlaName                   | TLA Name                    | The name of the territorial local authority (TLA) the crash has been attributed.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| temporarySpeedLimit       | Temporary Speed Limit       | The temporary (temp) speed (spd) limit (lim) at the crash site if one exists (e.g. for road works).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| trafficControl            | Traffic Control             | The traffic control (ctrl) signals at the crash site. Possible values are 'Traffic Signals', 'Stop Sign', 'Give Way Sign', 'Pointsman', 'School Patrol', 'Nil' or ' N/A'.                                                                                                                                                                                                                                                                                                                                                                                                                      |
| trafficIsland             | Traffic Island              | Derived variable to indicate how many times a traffic island, medians (excluding barriers)was struck in the crash.                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| trafficSign               | Traffic Sign                | Derived variable to indicate how many times 'traffic signage' (including traffic signals, their poles, bollards or roadside delineators) was struck in the crash.                                                                                                                                                                                                                                                                                                                                                                                                                              |
| train                     | Train                       | Derived variable to indicate how many times a train, rolling stock or jiggers was struck in the crash, whether stationary or moving                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| tree                      | Tree                        | Derived variable to indicate how many times trees or other growing items were struck during the crash.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| truck                     | Truck                       | Derived variable to indicate how many trucks were involved in the crash.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| unknownVehicleType        | Unknown Vehicle Type        | Derived variable to indicate how many vehicles were involved in the crash (where the vehicle type is unknown).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| urban                     | Urban                       | A derived variable using the 'spd_lim' variable. Possible values are 'Urban' (urban, spd_lim < 80) or 'Open Road' (open road, spd_lim >=80 or 'LSZ').                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| vanOrUtility              | Van or Utility              | Derived variable to indicate how many vans or utes were involved in the crash.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| vehicle                   | Vehicle                     | Derived variable to indicate how many times a stationary attended vehicle was struck in the crash. This includes broken down vehicles, workmen's vehicles, taxis, buses.                                                                                                                                                                                                                                                                                                                                                                                                                       |
| waterRiver                | Water River                 | Derived variable to indicate how many times a body of water (including rivers, streams, lakes, the sea, tidal flates, canals, watercourses or swanps) was struck in the crash.                                                                                                                                                                                                                                                                                                                                                                                                                 |
| weatherA                  | Weather A                   | Indicates weather at the crash time/place. See wthr_b. Values that are possible are 'Fine', 'Mist', 'Light Rain', 'Heavy Rain', 'Snow', 'Unknown'.                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| weatherB                  | Weather B                   | The weather at the crash time/place. See weather_a. Values 'Frost', 'Strong Wind' or 'Unknown'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |

1. December 17th 2019: Changes have been made to the data recorded in this field

## Development setup

1. Install the Databricks CLI from https://docs.databricks.com/dev-tools/cli/databricks-cli.html

2. Authenticate to your Databricks workspace, if you have not done so already:

   ```
   $ databricks configure
   ```

3. Install dbt

   To install dbt, you need a recent version of Python. For the instructions below,
   we assume `python3` refers to the Python version you want to use. On some systems,
   you may need to refer to a different Python version, e.g. `python` or `/usr/bin/python`.

   Run these instructions from the `cas` directory. We recommend making
   use of a Python virtual environment and installing dbt as follows:

   ```
   $ python3 -m venv .venv
   $ . .venv/bin/activate
   $ pip install -r requirements-dev.txt
   ```

4. Initialize your dbt profile

   Use `dbt init` to initialize your profile.

   ```
   $ dbt init
   ```

   Note that dbt authentication uses personal access tokens by default
   (see https://docs.databricks.com/dev-tools/auth/pat.html).
   You can use OAuth as an alternative, but this currently requires manual configuration.
   See https://github.com/databricks/dbt-databricks/blob/main/docs/oauth.md
   for general instructions, or https://community.databricks.com/t5/technical-blog/using-dbt-core-with-oauth-on-azure-databricks/ba-p/46605
   for advice on setting up OAuth for Azure Databricks.

   To setup up additional profiles, such as a 'prod' profile,
   see https://docs.getdbt.com/docs/core/connect-data-platform/connection-profiles.

5. Activate dbt so it can be used from the terminal

   ```
   $ . .venv/bin/activate
   ```

## Local development with dbt

Use `dbt` to [run this project locally using a SQL warehouse](https://docs.databricks.com/partners/prep/dbt.html):

```
$ dbt seed
$ dbt run
```

(Did you get an error that the dbt command could not be found? You may need
to try the last step from the development setup above to re-activate
your Python virtual environment!)

To just evaluate a single model defined in a file called orders.sql, use:

```
$ dbt run --model orders
```

Use `dbt test` to run tests generated from yml files such as `models/schema.yml`
and any SQL tests from `tests/`

```
$ dbt test
```

## Production setup

Your production dbt profiles are defined in dbt_profiles/profiles.yml.
These profiles define the default catalog, schema, and any other
target-specific settings. Read more about dbt profiles on Databricks at
https://docs.databricks.com/en/workflows/jobs/how-to/use-dbt-in-workflows.html#advanced-run-dbt-with-a-custom-profile.

The target workspaces for staging and prod are defined in databricks.yml.
You can manually deploy based on these configurations (see below).
Or you can use CI/CD to automate deployment. See
https://docs.databricks.com/dev-tools/bundles/ci-cd.html for documentation
on CI/CD setup.

## Manually deploying to Databricks with Databricks Asset Bundles

Databricks Asset Bundles can be used to deploy to Databricks and to execute
dbt commands as a job using Databricks Workflows. See
https://docs.databricks.com/dev-tools/bundles/index.html to learn more.

Use the Databricks CLI to deploy a development copy of this project to a workspace:

```
$ databricks bundle deploy --target dev
```

(Note that "dev" is the default target, so the `--target` parameter
is optional here.)

This deploys everything that's defined for this project.
For example, the default template would deploy a job called
`[dev yourname] cas_job` to your workspace.
You can find that job by opening your workpace and clicking on **Workflows**.

You can also deploy to your production target directly from the command-line.
The warehouse, catalog, and schema for that target are configured in databricks.yml.
When deploying to this target, note that the default job at resources/cas.job.yml
has a schedule set that runs every day. The schedule is paused when deploying in development mode
(see https://docs.databricks.com/dev-tools/bundles/deployment-modes.html).

To deploy a production copy, type:

```
$ databricks bundle deploy --target prod
```

## IDE support

Optionally, install developer tools such as the Databricks extension for Visual Studio Code from
https://docs.databricks.com/dev-tools/vscode-ext.html. Third-party extensions
related to dbt may further enhance your dbt development experience!

# Dev Container Setup

Onboarding

- Set local env vars before opening the IDE (VS Code):
  - CLAUDE_ROUTER_GPT_API_BASE_URL
  - CLAUDE_ROUTER_GPT_API_KEY
  - CLAUDE_ROUTER_ADB_SONNET_API_BASE_URL
  - CLAUDE_ROUTER_ADB_SONNET_API_KEY
  - From desktop:
  ```bash
  export CLAUDE_ROUTER_GPT_API_BASE_URL=https://xxxxxx.openai.azure.com/openai/deployments/gpt-5/chat/completions?api-version=2024-12-01-preview && export CLAUDE_ROUTER_GPT_API_KEY=xxxxx && export CLAUDE_ROUTER_ADB_SONNET_API_BASE_URL=https://xxxxxx.azuredatabricks.net/serving-endpoints/databricks-claude-sonnet-4/invocations && export CLAUDE_ROUTER_ADB_SONNET_API_KEY=xxxxx && code <current_project_folder>
  ```
- Rebuild/reopen the Dev Container. The setup will generate ~/.claude-code-router/config.json and whitelist the domain derived from CLAUDE_ROUTER_GPT_API_BASE_URL.

Notes

- CLAUDE_ROUTER_API_KEY is sensitive; set it only in your local environment, not in source control.
- For Claude Code, see repo [claude-code](https://github.com/anthropics/claude-code)
- For Claude Code Router, see repo [claude-code-router](https://github.com/musistudio/claude-code-router)
- For other tools:
  - [Context7](https://github.com/upstash/context7)
  - [ccundo](https://github.com/RonitSachdev/ccundo)

Limitations

- This Dev Container config with Claude Code Router is for Azure AI Foundry and Azure Databricks SONNET model compatibility only.
- This setup does not support Claude extended thinking.
- This setup does not support analysing images.
- This setup does not support web search.

# MCP config

From terminal, by running commandline, we can add local mcp server or remote mcp server.

For local, `claude mcp add <myserver> -- <npx or python> <mcp_package>`, e.g. `claude mcp add context7 -- npx @upstash/context7-mcp`.

For remote, `claude mcp add --transport <protocal> <myserver> <mcp_server_address>`, e.g. `claude mcp add --transport http context7 https://mcp.context7.com/mcp`.

To confirm mcp is properly installed, go to `ccr code` and `/mcp` to see connection status. And test in prompt messages. When inside a devcontainer with firewall settings, remote domains need to be whitelisted, by adding domain names into `.devcontainer/ini-firewall.sh`, line 74.

To remove a mcp `claude mcp remove <myserver>`, e.g. `claude mcp remove context7`.

Note:

- [Github Official MCP](https://github.com/github/github-mcp-server)

# Permissions

From Claude Code (`ccr code`), use `/permissions` to define "Allow"/"Ask"/"Deny"/"Workspace" rules, and choose scope "Project Settings (local)"/"Project Settings"/"User settings".

Example, in allow list, add `Bash(git commit:*)` rule, with active scope of "Project Settings (local)". Now there's a new rule visible at `.claude/settings.local.json`.

Here under .claude, settings.local.json and settings.json, see for [intro](https://docs.anthropic.com/en/docs/claude-code/settings#settings-files), see for [precedence](https://docs.anthropic.com/en/docs/claude-code/settings#settings-precedence).

For internal tools like `Bash`, more from official [here](https://docs.anthropic.com/en/docs/claude-code/settings#tools-available-to-claude)

For managing permission on mcps, simply put `mcp__<mcp_name>` as rule.

Another way, start claud code with `--dangerously-skip-permissions`, like `ccr code --dangerously-skip-permissions`, means claude code don't need to ask for any permission, all permisssions are allowed.

# Custom Commands with '/'

[Official guidance](https://docs.anthropic.com/en/docs/claude-code/slash-commands#custom-slash-commands)

Files under this `.claude/commands/` folder are the custom commands available for Claude Code, and file names are the command names.

Example:

```bash
# Create a project command
mkdir -p .claude/commands
echo "对比这个分支: $ARGUMENTS，与$ARGUMENTS分支的差异，并且提出你的review意见" > .claude/commands/code_review.md
```

After restart Claude Code, you can simply `/code_review feat/br-123-add-page main` where 'feat/br-123-add-page' is the value for the first $ARGUMENTS and 'main' is the value for the second.

# Hook

See [official guide](https://docs.anthropic.com/en/docs/claude-code/hooks)

# Sub Agent

See [official guide](https://docs.anthropic.com/en/docs/claude-code/sub-agents)
